---
theme: cyanosis
highlight: atom-one-dark
---

æŒç»­åˆ›ä½œï¼ŒåŠ é€Ÿæˆé•¿ï¼è¿™æ˜¯æˆ‘å‚ä¸ã€Œæ˜é‡‘æ—¥æ–°è®¡åˆ’ Â· 10 æœˆæ›´æ–‡æŒ‘æˆ˜ã€çš„ç¬¬ 1 å¤©ï¼Œç‚¹å‡»æŸ¥çœ‹æ´»åŠ¨è¯¦æƒ…

> ç‹å¿—è¿œï¼Œå¾®åŒ»å‰ç«¯æŠ€æœ¯éƒ¨

# ç³»åˆ—æ–‡ç›®å½•

| å°èŠ‚ä¸»é¢˜                                                                                  | æ–‡æ¡£                                       | æœŸå¾…äº§å‡º                                        | è¡¥å…… |
| ----------------------------------------------------------------------------------------- | ------------------------------------------ | ----------------------------------------------- | ---- |
| å­¦ä¹ èµ·å§‹ç¯‡                                                                                | https://juejin.cn/post/7148604483822419998 | æ‰©å±•èƒ½åšåˆ°ä»€ä¹ˆ/å¦‚ä½•å­¦ä¹ æ‰©å±•/æ‰©å±•åŸºç¡€ç»„æˆæ¦‚å¿µ    |      |
| å¼€å‘è°ƒè¯•å‘å¸ƒ                                                                              | https://juejin.cn/post/7148618712646418439 | ç†Ÿæ‚‰è°·æ­Œæ‰©å±•çš„å¼€å‘æµç¨‹/è°ƒè¯•æµç¨‹/å‘å¸ƒæµç¨‹        |      |
| è°·æ­Œæ‰©å±•å¼€å‘èƒ½åŠ›è¯¦è§£ï¼šæ•°æ®æµå¤„ç†èƒ½åŠ›ã€UI èƒ½åŠ›ã€æµè§ˆå™¨ç‰¹æ€§ï¼ˆå†å²/ä¹¦ç­¾/ä¸‹è½½/ç½‘ç»œè¯·æ±‚/ç­‰ç­‰ï¼‰ | https://juejin.cn/post/7147105998728085541 | æ‰©å±•èƒ½åŠ›çŸ¥è¯†ä½“ç³»å­¦ä¹ ï¼Œæ ¹æ®æ–‡æ¡£å®ç°æ‰€æœ‰ç›¸å…³ demo |      |
| æ¡†æ¶å‡çº§ï¼šVue å¼€å‘å®ç°ä¸€å›¾ä¸€è¯—ï¼ˆæ–°å¼€ tab é¡µæ‰“å¼€è‡ªå·±çš„å†…å®¹ï¼‰                               | æœ¬æ–‡                                       | ä½¿ç”¨ Vue å¼€å‘æ‰©å±•                               |      |
| chrome æ‰©å±•è„šæ‰‹æ¶å®ç°ï¼švue2+elementui ç‰ˆæœ¬                                                |                                            | å®ç° vue å¼€å‘æ‰©å±•è„šæ‰‹æ¶                         |      |
| è½åœ°ï¼šdebug-plugin é›†æˆè°·æ­Œæ‰©å±•                                                           |                                            | åŸè°ƒè¯•æ’ä»¶é‡æ„ä¸ºè°·æ­Œæ‰©å±•å¹¶é›†æˆè¿›é¡¹ç›®            |      |

# å‰è¨€

â€‹ å®æˆ˜ç¯‡å•¦ï¼Œç»è¿‡å‰é¢ç³»åˆ—æ–‡ç« ï¼Œæˆ‘ä»¬å¯¹ chrome æ‰©å±•çš„å¼€å‘å·²ç»æœ‰äº†å¤§è‡´äº†è§£ï¼ˆä¸äº†è§£ï¼ŸğŸ‘†ï¼‰ï¼Œæœ€æœ€åŸºç¡€ä¸€ç‚¹ï¼Œchrome æ‰©å±•å…¶å®å°±æ˜¯ html/css/js ä¸‰å¤§ä»¶ï¼Œé‚£ä¹ˆï¼Œåœ¨ç»å†äº† vue/react/angular æ¡†æ¶çš„æ—¥å¸¸åï¼Œæˆ‘ä»¬çœŸçš„éœ€è¦ä¸€è¡Œè¡Œçš„å»å®ç°åŸå§‹çš„ä¸‰å¤§ä»¶å—ï¼Ÿç­”æ¡ˆè‚¯å®šæ˜¯ï¼Œä¸éœ€è¦ã€‚

â€‹ æ˜é‡‘çš„æµè§ˆå™¨æ‰©å±•ç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´éƒ½è§è¿‡ï¼Œå³æ–°å¼€ tab é¡µæ—¶ä¼šæ‰“å¼€æ˜é‡‘çš„é¡µé¢ä½œä¸ºé»˜è®¤æ˜¾ç¤ºé¡µã€‚è¿™ä¸ªåŠŸèƒ½æ˜¯è°·æ­Œæ‰©å±•çš„ over_page é…ç½®ï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿåœ¨[è°·æ­Œæ‰©å±•å¼€å‘èƒ½åŠ›è¯¦è§£ï¼šæ•°æ®æµå¤„ç†èƒ½åŠ›ã€UI èƒ½åŠ›ã€æµè§ˆå™¨ç‰¹æ€§ï¼ˆå†å²/ä¹¦ç­¾/ä¸‹è½½/ç½‘ç»œè¯·æ±‚/ç­‰ç­‰ï¼‰](https://juejin.cn/post/7147105998728085541)ä¸€æ–‡ä¸­è§è¿‡ï¼Œè¿™æ¬¡æˆ‘ä»¬å°±æ¥ç»“åˆ vue å®ç°ä¸€ä¸ªè‡ªå·±çš„â€œä¸€å›¾ä¸€è¯—â€å§ï¼

![](https://raw.githubusercontent.com/Sympath/imgs/main/v2-6bb953c88d6fac3d523b8d7aedcd0535_720w.jpg)

### æ•ˆæœå¦‚ä¸‹

![](https://raw.githubusercontent.com/Sympath/imgs/main/2022-09-24%2017.50.55.gif)

# çŸ¥è¯†ç»“æ„

- Vue çš„æ‰©å±•å¼€å‘ç¯å¢ƒæ­å»º

  - è„šæ‰‹æ¶åˆ›å»º
  - vue é¡¹ç›®æ­å»º
  - æ”¯æŒ chrome æ‰©å±•ï¼šæ”¹é€ /åŠ è½½æ’ä»¶/çƒ­æ›´æ–°

- Chrome æ‰©å±•çš„ Tab é¡µé¢ Overide åŠŸèƒ½
  - Ajax è¯·æ±‚ç¬¬ä¸‰æ–¹æ¥å£
  - Vue çš„çƒ­æ›´æ–°å¼€å‘

# Vue çš„æ‰©å±•å¼€å‘ç¯å¢ƒæ­å»º

## è„šæ‰‹æ¶åˆ›å»º

è¿™é‡Œæå‰è¯´ä¸‹ä¸‹ä¸€ç¯‡æ–‡ç« çš„å†…å®¹ï¼Œæˆ‘å®ç°äº†ä¸€ä¸ªåˆ›å»ºã€Vue çš„æ‰©å±•å¼€å‘ç¯å¢ƒã€‘çš„è„šæ‰‹æ¶ï¼Œå¦‚æœå¤§å®¶æ‡’å¾—è·Ÿç€åæ–‡ä¸€æ­¥æ­¥å®ç°ï¼Œè€Œæ˜¯åªæƒ³çœ‹çœ‹æ€è·¯ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…åˆ›å»º

```js
npm install vue-chrome-cli -g
vue-chrome-cli init test
```

ä¹Ÿå¯ä»¥é€šè¿‡æˆ‘å®ç°çš„ vscode æ’ä»¶ã€weiyi-toolsã€‘è¿›è¡Œå›¾å½¢åŒ–æ“ä½œä¸€æ­¥å®‰è£…æ‰§è¡Œ

![](https://raw.githubusercontent.com/Sympath/imgs/main/2022-10-08%2018.13.50.gif)

## vue è„šæ‰‹æ¶ç¯å¢ƒæ­å»º

```js
npm install -g @vue/cli // å¦‚æœæ²¡æœ‰å®‰è£…è¿‡ vue è„šæ‰‹æ¶
vue create my-extension
cd my-extension
npm run serve
```

è¿™æ—¶ä¼šè‡ªåŠ¨æ‰“å¼€å¦‚ä¸‹ç•Œé¢ï¼Œå±äºæ­£å¸¸ vue æ€è·¯ï¼Œä¸åŠ èµ˜è¿°

![](https://cdn.poizon.com/node-common/7e256b83c70ced67abab8c4fd16ad4cd.png)

## æ”¯æŒ chrome æ‰©å±•

æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ç»“æœï¼Œæœ€ç»ˆç›®å½•ç»“æ„å¦‚ä¸‹

```
.
|-- README.md
|-- babel.config.js
|-- jsconfig.json
|-- package-lock.json
|-- package.json
|-- public
|   |-- favicon.ico
|   |-- index.html
|-- src
|   |-- content-script
|   |   |-- App.vue
|   |   |-- content-script.css
|   |   |-- cs-init.js
|   |   |-- element-variables.scss
|   |   |-- index.js
|   |-- manifest.json
|   |-- options
|   |   |-- App
|   |   |-- index.html
|   |   |-- index.js
|   |-- popup
|       |-- App
|       |-- index.html
|       |-- index.js
|-- vue.config.js
```

è¡¥å……ï¼šä¸€ä¸ªä¸ªå»ºç›®å½•å¤ªéº»çƒ¦ï¼Œæ¨èä¸ªäººå¼€å‘çš„ vscode æ’ä»¶ weiyi-toolsï¼Œå®‰è£…å¥½å

1. å¤åˆ¶ä¸Šé¢ç›®å½•ç»“æ„å†…å®¹
2. åœ¨ä¾§è¾¹æ è‡ªå·±æƒ³è¦çš„ç©ºç›®å½•å¤„å³é”®
3. æ‰¾åˆ°ã€é€‰ä¸­ç›®å½•å·¥å…·ç®± - æ ¹æ® tree ç»“æœç”Ÿæˆç›®å½•ã€‘ï¼Œç‚¹å‡»

æ•ˆæœå¦‚ä¸‹

<img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h3kldh54m8j217v0u0q56.jpg" alt="2022-06-24 14.40.09" style="zoom:25%;" />

### å¯¹ vue è„šæ‰‹æ¶é¡¹ç›®çš„æ”¹é€ 

##### åŸºç¡€æ“ä½œ

1. åˆ é™¤æ— ç”¨æ–‡ä»¶ï¼š`main.js`ã€`App.vue`ã€`components`ä»¥åŠæ–‡ä»¶å¤¹ä¸‹çš„`HelloWorld.vue`ã€`logo.png`æ–‡ä»¶
2. é…ç½®æ‰©å±•å›¾æ ‡ï¼šä»[é˜¿é‡Œå·´å·´çŸ¢é‡å›¾æ ‡åº“](https://www.iconfont.cn/) ä¸‹è½½è‡ªå·±æƒ³è¦çš„å›¾æ ‡æ–‡ä»¶ï¼Œå»ºè®®ç”¨ 16ã€48ã€128 è¿™ä¸‰ç§å¤§å°çš„å›¾æ ‡ï¼Œå°†ä¸‹è½½çš„å›¾æ ‡æ”¾åˆ°`public`ä¸‹é¢ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥ç”¨ vue å»æ­å»ºå¯¹åº”é¡µé¢çš„å¼€å‘å•¦ï¼è¿™é‡Œçš„æ­å»ºéœ€è¦åˆ†ä¸ºä¸¤ç±»ï¼šå…·æœ‰ dom ç›¸å…³æ˜¾ç¤ºçš„ï¼Œå¦‚`popup`ã€`options`ã€`content_script`ï¼›ä»¥åŠçº¯é€»è¾‘çš„ï¼Œå¦‚ backgroundã€‚

3. é”å®šä¾èµ–ï¼šä¸ºé¿å…ç‰ˆæœ¬é—®é¢˜è´¹æ—¶è´¹åŠ›ï¼Œå»ºè®®ç›´æ¥å¤åˆ¶å¦‚ä¸‹ package.json å†…å®¹ï¼Œå®‰è£…ä¾èµ–

```json
{
  "name": "hello-chrome-vue",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "serve": "vue-cli-service serve",
    "build": "vue-cli-service build",
    "build-watch": "vue-cli-service build-watch"
  },
  "dependencies": {
    "core-js": "^3.8.3",
    "element-ui": "^2.15.10",
    "vue": "^2.6.14",
    "vue-router": "^3.5.1"
  },
  "devDependencies": {
    "@vue/cli-plugin-babel": "~5.0.0",
    "@vue/cli-plugin-router": "~5.0.0",
    "@vue/cli-service": "~5.0.0",
    "copy-webpack-plugin": "^4.6.0",
    "sass": "^1.55.0",
    "sass-loader": "^13.1.0",
    "vue-cli-plugin-chrome-ext": "0.0.5",
    "vue-template-compiler": "^2.6.14"
  },
  "browserslist": ["> 1%", "last 2 versions", "not dead"]
}
```

##### å®ç° vue å¼€å‘å¯¹åº”é¡µé¢ï¼š`popup`ã€`options`ã€`content_script`

`popup`ã€`options`ã€`content_script`è¿™ä¸‰ç±»åˆ†åˆ«ä»£è¡¨ç€å¼¹å‡ºå±‚/é€‰é¡¹é¡µå’Œæ³¨å…¥é¡µé¢çš„è„šæœ¬ï¼›

`src`æ–‡ä»¶å¤¹ä¸‹é¢åˆ›å»º `popup`ã€`options`ã€`content_script`æ–‡ä»¶å¤¹ï¼Œå…¶å†…å®¹å‡ä¸ºç‹¬ç«‹çš„ vue ç»“æ„ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹

```
|-- App
|-- |-- app.vue
|-- index.html
|-- index.js
```

index.js

```js
import Vue from "vue";
import AppComponent from "./App/App.vue";
import ElementUI from "element-ui";
import "element-ui/lib/theme-chalk/index.css";

Vue.use(ElementUI);
Vue.component("app-component", AppComponent);

new Vue({
  el: "#app",
  render: (createElement) => {
    return createElement(AppComponent);
  },
});
```

index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>popup</title>
  </head>
  <body>
    <noscript>
      <strong
        >We're sorry but test-dir doesn't work properly without JavaScript
        enabled. Please enable it to continue.</strong
      >
    </noscript>
    <div id="app"></div>
    <!-- built files will be auto injected -->
  </body>
</html>
```

App/app.vue

```vue
<template>
  <div class="main_app">
    <h1>Hello popup</h1>
    <el-divider></el-divider>
  </div>
</template>

<script>
export default {
  name: "app",
  mounted() {},
};
</script>

<style>
.main_app {
  font-family: "Avenir", Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
}
</style>
```

##### å¯¹ content_script çš„å…¼å®¹ï¼šæå‰ç”ŸæˆæŒ‚è½½ç‚¹

è¿™é‡Œå°† content_script å½’ç±»åœ¨å…·æœ‰ dom çš„ç±»åˆ«é‡Œï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å¸¸å¸¸ç”¨å®ƒå»æ“ä½œæˆ–æ’å…¥ä¸€äº›ç½‘é¡µ domï¼Œæ‰€ä»¥çœ‹èµ·æ¥å®ƒæ˜¯çº¯é€»è¾‘ï¼Œä½†æˆ‘ä»¬å¯ä»¥åšä¸‹å…¼å®¹ä»è€Œä½¿å¾—ä¹Ÿç”¨ vue å¼€å‘ï¼Œå³åœ¨å¼•å…¥å‰å…ˆåˆ›å»ºä¸€ä¸ªæŒ‚è½½ç‚¹ domã€‚æˆ‘ä»¬å¯ä»¥åœ¨ content_script ä¸‹åˆ›å»ºä¸€ä¸ª init.jsï¼Œå†…å®¹å¦‚ä¸‹

```js
const contentScriptDiv = document.createElement("div");
contentScriptDiv.id = "contentScript";
document.body.appendChild(contentScriptDiv);
```

ç„¶ååœ¨ manifest.json ä¸­é…ç½®å³å¯ï¼ˆæ­¤å¤„ç‚¹å‡ºæ–¹ä¾¿ç†è§£ï¼Œåœ¨ä¸‹é¢çš„ manifest æ–‡ä»¶ä¸­å…¶å®æ˜¯å·²ç»æœ‰äº†çš„ï¼‰

```json
"content_scripts": [
    {
      "matches": ["*://*/*"],
      "css": ["content-script/content-script.css"],
      "js": ["content-script/init.js", "js/content-script.js"],
      "run_at": "document_end"
    }
  ]
```

##### çº¯é€»è¾‘æ–‡ä»¶æ”¯æŒï¼šbackground.js

å…ˆåœ¨ vue.config.js ä¸­é…ç½®

```js
configureWebpack: {
		entry: {
			background: "./src/background/main.js"
		},
		output: {
			filename: "js/[name].js"
		}
	},
```

ç„¶ååœ¨ src/background ä¸‹æ–°å»ºä¸€ä¸ª main.jsï¼Œå®ç°è‡ªå·±çš„é€»è¾‘å³å¯

##### æ–°å¢æ–‡ä»¶é…ç½®

- `manifest.json`

æˆ‘ä»¬å…ˆé…ç½® `src/plugins/manifest.json` æ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨å‰é¢å·²ç»è¯´è¿‡ï¼Œè¿™ä¸ªæ˜¯ `Chrome` æ’ä»¶å¿…é¡»çš„æ–‡ä»¶ã€‚

```js
{
  "manifest_version": 2,
  "name": "hello-chrome-vue",
  "description": "vue å¼€å‘ chrome",
  "version": "0.0.1",
  "options_page": "options.html",
  "browser_action": {
    "default_popup": "popup.html"
  },
  "content_scripts": [
    {
      "matches": ["*://*/*"],
      "css": ["content-script/content-script.css"],
      "js": ["content-script/cs-init.js", "js/content-script.js"],
      "run_at": "document_end"
    }
  ]
}

```

- åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º`vue.config.js`çš„`vue`é…ç½®æ–‡ä»¶ï¼Œ`vue.config.js`

`vue.config.js` æ–‡ä»¶ä½œä¸º `vue` é¡¹ç›®æ‰“åŒ…ï¼Œè¿è¡Œç­‰çš„åŸºæœ¬é…ç½®ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ‰“åŒ…æˆä¸ºæˆ‘ä»¬ `Chrome` æ’ä»¶æ‰€éœ€è¦çš„é¡¹ç›®ç›®å½•ã€‚

é…ç½®`vue.config.js`å†…å®¹å¦‚ä¸‹ï¼Œä»¥åšåˆ°

1. "popup", "options", "content-script"å¤šé¡µåº”ç”¨æ‰“åŒ…
2. img / content-script.css content-script/init.js ç›´æ¥å¤åˆ¶
3. background/main.js æ‰“åŒ…åç›´æ¥å¤åˆ¶

```js
const CopyWebpackPlugin = require("copy-webpack-plugin");
const path = require("path");

// Generate pages object
const pagesObj = {};

const chromeName = ["popup", "options", "content-script"];

chromeName.forEach((name) => {
  pagesObj[name] = {
    entry: `src/${name}/index.js`,
    template: "public/index.html",
    filename: `${name}.html`,
  };
});
let commonPlugins = [
  { from: "src/content-script/init.js", to: "content-script/init.js" },
  {
    from: "src/content-script/content-script.css",
    to: "content-script/content-script.css",
  },
  {
    from: "src/manifest.json",
    to: "manifest.json",
    transform: (content) => {
      const jsonContent = JSON.parse(content);
      // jsonContent.version = version;

      if (process.env.NODE_ENV !== "production") {
        jsonContent["content_security_policy"] =
          "script-src 'self' 'unsafe-eval'; object-src 'self'";
      }

      return JSON.stringify(jsonContent, null, 2);
    },
  },
];
module.exports = {
  pages: pagesObj,
  configureWebpack: {
    entry: {
      background: "./src/background/main.js",
    },
    output: {
      filename: "js/[name].js",
    },
    plugins: [CopyWebpackPlugin(commonPlugins)],
  },
};
```

##### æ‰“åŒ…

```js
npm run build
```

å¯ä»¥çœ‹åˆ°æ‰“å°å°å·²ç»å®Œæˆæ‰“åŒ…

![](https://raw.githubusercontent.com/Sympath/imgs/main/image-20221009085620856.png)

### åŠ è½½æ’ä»¶

åœ¨`Chrome` æ’ä»¶ä¸­`åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº` ï¼Œé€‰æ‹©æˆ‘ä»¬çš„ `dist` æ–‡ä»¶ï¼Œå³å¯å‘ç°æˆ‘ä»¬çš„æ’ä»¶å·²ç»æˆåŠŸå®‰è£…å®Œ â˜¹ï¸

ä¹‹å‰å†™è¿‡ï¼Œå¤ç”¨ä¸€ä¸‹ï¼Œä¸äº†è§£è¿™æ­¥çš„åŒå­¦å¯è§æ–‡ç« ï¼šhttps://juejin.cn/post/7148618712646418439

![](https://raw.githubusercontent.com/Sympath/imgs/main/20210917161419672.jpeg)

### ä¼˜åŒ–ï¼šçƒ­æ›´æ–°

æˆ‘ä»¬ä¼šå‘ç°ï¼Œå°½ç®¡ä»‹å…¥äº† vue+elementuiï¼Œæˆ‘ä»¬çš„å¼€å‘ä½“é‡ç¬é—´å°äº†æ•°ä¸ªé‡é‡çº§ï¼Œä½†å¼€å‘è¿‡ç¨‹è¿˜æ˜¯ã€å†™ä»£ç  - æ‰©å±•ç®¡ç†é¡µç‚¹å‡»æ‰©å±•æ›´æ–°- åˆ·æ–°é¡µé¢ ã€‘ï¼Œè¿™ä¹Ÿå¤ªéº»çƒ¦äº†å­ï¼ï¼

ã€è¡¨æƒ…ã€‘

èƒ½ä¸èƒ½æˆ‘æœ¬åœ°ä¿®æ”¹å®Œä»£ç è‡ªåŠ¨è‡ªåŠ¨å¸®æˆ‘åšè¿™äº›å‘¢ï¼Ÿä½ æƒ³åˆ°äº†ä»€ä¹ˆï¼Ÿæ²¡é”™ï¼Œå°±æ˜¯çƒ­æ›´æ–°ï¼›çƒ­æ›´æ–°ä¸€èˆ¬æŒ‡ app æœ‰å°è§„æ¨¡æ›´æ–°ï¼Œä»¥ç›´æ¥æ‰“è¡¥ä¸çš„å½¢å¼æ›´æ–° appï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæœ‰å°çš„æ›´æ–°å°±è®©ç”¨æˆ·é‡æ–°ä¸‹è½½å®Œæ•´åŒ…ï¼Œä¼°è®¡æ²¡å‡ å¤©è¿™ä¸ª app å°±æ²¡äººç”¨äº†ã€‚web ç«¯å…¶å®æœ€å¼€å§‹çƒ­æ›´æ–°äº†ï¼Œä¸»è¦å› ä¸º web æ˜¯ B/Sï¼ˆæµè§ˆå™¨+æœåŠ¡ç«¯ï¼‰ï¼Œæµè§ˆå™¨ä¸»è¦å’ŒæœåŠ¡å™¨é€šè¿‡ http åè®®é€šä¿¡ï¼ŒæœåŠ¡ç«¯å“åº” http è¯·æ±‚ä¹‹åï¼Œæœ¬æ¬¡ http è¿æ¥å°±ç»“æŸäº†ï¼Œåé¢å‡ºç°äº† websocket+EventSource æ‰è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚

é‚£è°·æ­Œæ‰©å±•å‘¢ï¼Ÿå¤§å¯ä¸å¿…è¿™ä¹ˆéº»çƒ¦ï¼Œæ‰©å±•æœºåˆ¶æä¾›äº†å¦‚ä¸‹æ¥å£

1. backgroundï¼šä¸€ç›´è¿è¡Œåœ¨åå°çš„é€»è¾‘
2. getPackageDirectoryEntryï¼šè·å–æ‰€æœ‰æ‰©å±•åŒ…æ–‡ä»¶å®ä¾‹åŠåœ°å€
3. tabs.queryï¼šè·å–å½“å‰æ‰“å¼€çš„ tab é¡µé¢
4. runtime.reloadï¼šåˆ·æ–°é¡µé¢

è¿™æ ·æ€è·¯å°±å˜çš„å¾ˆæ¸…æ™°äº†ï¼Œæˆ‘ä»¬åœ¨ background.js ä¸­å®ç°ã€è·å–æ‰€æœ‰æ‰©å±•åŒ…æ–‡ä»¶åœ°å€ - ç”Ÿæˆå¯¹åº”æ—¶é—´æˆ³ - æ¯ä¸€ç§’æŸ¥è¯¢ä¸€æ¬¡æ—¶é—´æˆ³æ˜¯å¦æ›´æ”¹ - æ›´æ”¹äº†åˆ™è·å–å½“å‰é¡µå¹¶è¿›è¡Œåˆ·æ–°ã€‘ï¼Œè¿™æ ·å°±å®ç°å•¦ï¼

ã€è¡¨æƒ…ã€‘

æ•ˆæœå¦‚ä¸‹ï¼ˆæ³¨æ„ï¼Œè¿™ä¸ªä¸€å®šè¦åœ¨å¼€å‘ç¯å¢ƒä¸‹æ‰å¼€å¯ï¼Œä¸ç„¶å¤ªå½±å“æ€§èƒ½äº†ï¼‰

![](https://raw.githubusercontent.com/Sympath/imgs/main/2022-10-09%2009.09.01.gif)

å…·ä½“ä»£ç å¦‚ä¸‹

###### åœ¨`utils` æ–‡ä»¶å¤¹ä¸‹åˆ›å»º `hotReload.js`

```javascript
// åŠ è½½æ–‡ä»¶

const filesInDirectory = (dir) =>
  new Promise((resolve) =>
    dir.createReader().readEntries((entries) => {
      Promise.all(
        entries
          .filter((e) => e.name[0] !== ".")
          .map((e) =>
            e.isDirectory
              ? filesInDirectory(e)
              : new Promise((resolve) => e.file(resolve))
          )
      )
        .then((files) => [].concat(...files))
        .then(resolve);
    })
  );

// éå†æ’ä»¶ç›®å½•ï¼Œè¯»å–æ–‡ä»¶ä¿¡æ¯ï¼Œç»„åˆæ–‡ä»¶åç§°å’Œä¿®æ”¹æ—¶é—´æˆæ•°æ®
const timestampForFilesInDirectory = (dir) =>
  filesInDirectory(dir).then((files) =>
    files.map((f) => f.name + f.lastModifiedDate).join()
  );

// åˆ·æ–°å½“å‰æ´»åŠ¨é¡µ
const reload = () => {
  window.chrome.tabs.query(
    {
      active: true,
      currentWindow: true,
    },
    (tabs) => {
      // NB: see https://github.com/xpl/crx-hotreload/issues/5
      if (tabs[0]) {
        window.chrome.tabs.reload(tabs[0].id);
      }
      // å¼ºåˆ¶åˆ·æ–°é¡µé¢
      window.chrome.runtime.reload();
    }
  );
};

// è§‚å¯Ÿæ–‡ä»¶æ”¹åŠ¨
const watchChanges = (dir, lastTimestamp) => {
  timestampForFilesInDirectory(dir).then((timestamp) => {
    // æ–‡ä»¶æ²¡æœ‰æ”¹åŠ¨åˆ™å¾ªç¯ç›‘å¬ watchChanges æ–¹æ³•
    if (!lastTimestamp || lastTimestamp === timestamp) {
      setTimeout(() => watchChanges(dir, timestamp), 1000); // retry after 1s
    } else {
      // å¼ºåˆ¶åˆ·æ–°é¡µé¢
      reload();
    }
  });
};

const hotReload = () => {
  window.chrome.management.getSelf((self) => {
    if (self.installType === "development") {
      // è·å–æ’ä»¶ç›®å½•ï¼Œç›‘å¬æ–‡ä»¶å˜åŒ–
      window.chrome.runtime.getPackageDirectoryEntry((dir) =>
        watchChanges(dir)
      );
    }
  });
};

export default hotReload;
```

åœ¨`background/main.js` ä¸­å¼•å…¥

```javascript
import hotReload from "@/utils/hotReload";
hotReload();

console.log("hello world background");
```

è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ chrome å¼€å‘ vue ç¯å¢ƒä¹Ÿå°±æ­å»ºå®Œæˆå•¦ï¼ï¼å‡†å¤‡å¼€å§‹å¼€å‘æˆ‘ä»¬çš„é¡¹ç›®å§

![](https://raw.githubusercontent.com/Sympath/imgs/main/bfd01186db5e7514349f9b7146cdb437.jpeg)

# Chrome æ‰©å±•çš„ Tab é¡µé¢ Overide åŠŸèƒ½

æœ‰äº†ä¸Šé¢çš„æ¡†æ¶ï¼Œå®ç°é¡¹ç›®å˜å¾—å¼‚å¸¸çš„ç®€å•ï¼Œæ•ˆæœåœ¨æ–‡ç« å¼€å¤´å·²ç»åˆ†äº«è¿‡äº†ï¼Œæˆ‘ä»¬æ¥æ¢³ç†ä¸‹æ€è·¯

1. é…ç½®é¡¹ç›®æ¨¡ç‰ˆå¹¶è¦†ç›–é»˜è®¤é¡µé…ç½®
2. é…ç½®è¯·æ±‚

3. å¼€å‘è°ƒè¯•ä¸Šçº¿

### é…ç½®é¡¹ç›®æ¨¡ç‰ˆå¹¶è¦†ç›–é»˜è®¤é¡µé…ç½®

å¤åˆ¶å¦‚ä¸Šæ¨¡ç‰ˆï¼ˆæ¨èä½¿ç”¨`vue-chrom-cli`è„šæ‰‹æ¶åˆ›å»ºï¼‰ï¼Œå¤åˆ¶ popup ç›®å½•æ”¹åä¸º`override-page`ï¼›ç„¶ååœ¨ vue.config.js ä¸­æ‰¾åˆ°`chromeName`æ•°ç»„ï¼Œæ·»åŠ  override-page æ”¯æŒå¯¹åº”çš„æ‰“åŒ…ã€‚

```js
const chromeName = ["popup", "options", "content-script", "override-page"];
```

åœ¨ manifest.json ä¸­é…ç½®`chrome_url_overrides`è¦†ç›–é»˜è®¤é¡µå³å¯

```json
{
  ...
  "chrome_url_overrides": {
    "newtab": "override-page.html"
  }
}
```

### é…ç½®è¯·æ±‚

å› ä¸ºéœ€è¦ã€è·å–èƒŒæ™¯å›¾ç‰‡å’Œè·å–å¤è¯—æ•°æ®ã€‘ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¯·æ±‚æ¥å£ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ axios å¹¶åœ¨ manifest.json ä¸­é…ç½®æƒé™

##### å®‰è£…ä¾èµ–

```
npm i axios@^0.21.0
```

##### é…ç½®æƒé™

```json
{
  ...
  "permissions": [
    "<all_urls>",
    "*://*/*"
  ]
}
```

### å¼€å‘è°ƒè¯•ä¸Šçº¿

è¿™é‡Œçš„å¼€å‘æ²¡å•¥éš¾åº¦ï¼Œå°±æ˜¯æ—¥å¸¸é¡µé¢å¼€å‘ï¼Œä¸åŠ èµ˜è¿°äº†ï¼Œshow code

ä»“åº“åœ°å€ï¼šhttps://github.com/Sympath/training-camp-project/tree/main/chrome-pro/4.vue-extension

app.vue

```vue
<template>
  <div id="app">
    <Page msg="Welcome to ç‹å¿—è¿œ Vue.js App" />
  </div>
</template>

<script>
import Page from "./components/Page.vue";

export default {
  name: "App",
  components: {
    Page,
  },
};
</script>

<style>
/* http://meyerweb.com/eric/tools/css/reset/ 
   v2.0 | 20110126
   License: none (public domain)
*/

html,
body,
div,
span,
applet,
object,
iframe,
h1,
h2,
h3,
h4,
h5,
h6,
p,
blockquote,
pre,
a,
abbr,
acronym,
address,
big,
cite,
code,
del,
dfn,
em,
img,
ins,
kbd,
q,
s,
samp,
small,
strike,
strong,
sub,
sup,
tt,
var,
b,
u,
i,
center,
dl,
dt,
dd,
ol,
ul,
li,
fieldset,
form,
label,
legend,
table,
caption,
tbody,
tfoot,
thead,
tr,
th,
td,
article,
aside,
canvas,
details,
embed,
figure,
figcaption,
footer,
header,
hgroup,
menu,
nav,
output,
ruby,
section,
summary,
time,
mark,
audio,
video {
  margin: 0;
  padding: 0;
  border: 0;
  font-size: 100%;
  font: inherit;
  vertical-align: baseline;
}
/* HTML5 display-role reset for older browsers */
article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
menu,
nav,
section {
  display: block;
}
body {
  line-height: 1;
}
ol,
ul {
  list-style: none;
}
blockquote,
q {
  quotes: none;
}
blockquote:before,
blockquote:after,
q:before,
q:after {
  content: "";
  content: none;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
}

#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
}
</style>
```

components/page.vue

```vue
<template>
  <div v-bind:style="styeImg">
    <div class="page-widget">
      <div class="poem-content">
        <div>{{ this.poemData.content }}</div>
        <div class="poem-content-sub">
          ã€Š{{ this.poemData.origin }}ã€‹{{ this.poemData.author }}
        </div>
        <p class="page-date">{{ weekDay }}</p>
        <p>hot refresh local:8080</p>
      </div>
    </div>
    <div class="page-author">
      <a href="http://82.157.62.28:49153/">by ç‹å¿—è¿œ</a>
    </div>
  </div>
</template>

<script>
import axios from "axios";
export default {
  name: "Page",
  mounted() {},
  computed: {
    weekDay() {
      var week = new Date().getDay(),
        arr = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"],
        str = "æ˜ŸæœŸ" + arr[week];
      return str;
    },
  },
  created() {
    this.loadImage();
    this.loadPoem();
  },
  data() {
    return {
      styeImg: {
        backgroundImage: "",
        width: "100%",
        height: "100%",
        backgroundSize: "cover",
      },
      poemData: {},
    };
  },
  methods: {
    /**
     * è·å–èƒŒæ™¯å›¾ç‰‡
     * https://cn.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1
     */
    loadImage() {
      axios
        .get("https://cn.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1")
        .then((response) => {
          this.styeImg.height = `${window.innerHeight}px`;
          this.styeImg.backgroundImage = `url(http://s.cn.bing.net${response.data.images[0].url})`;
        })
        .catch((error) => {
          console.log(error);
        });
    },
    /**
     * è·å–å¤è¯—æ•°æ®
     * https://v1.jinrishici.com/all.json
     */
    loadPoem() {
      axios
        .get("https://v1.jinrishici.com/all.json")
        .then((response) => {
          this.poemData = response.data;
        })
        .catch((error) => {
          console.log(error);
        });
    },
  },
};
</script>

<style scoped>
p {
  font-size: 20px;
}
.page-widget {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translateX(-50%);
  transform: translate(-50%, -50%);
  line-height: 46px;
  font-size: 26px;
  color: white;
  background-color: rgba(0, 0, 0, 0.5);
  padding: 40px 20px;
  border-radius: 10px;
}
.poem-content-sub {
  font-size: 20px;
}
.page-author {
  font-size: 13px;
  color: white;
  position: absolute;
  right: 15px;
  bottom: 20px;
}
.page-author a {
  color: white;
  text-decoration: none;
}
</style>
```

æ‰§è¡Œè°ƒè¯•å‘½ä»¤

```
npm run build-watch
```

ç„¶åå®‰è£…æ‰©å±•æŒ‡å®š dist ç›®å½•å³å¯ã€‚ä¸äº†è§£è¿™æ­¥çš„åŒå­¦å¯è§æ–‡ç« ï¼šhttps://juejin.cn/post/7148618712646418439

è‡³æ­¤ï¼Œæˆ‘ä»¬å°±ç”¨ vue å¼€å‘äº†ä¸€ä¸ªç±»ä¼¼æ˜é‡‘çš„ã€æ‰“å¼€æ–° tab æ—¶é»˜è®¤æ˜¾ç¤ºè‡ªå·±é¡µé¢ã€‘å¯¹æ‰©å±•ï¼Œæ˜¯ä¸æ˜¯å¾ˆé…·ï¼ï¼ï¼

![](https://raw.githubusercontent.com/Sympath/imgs/main/1651cbfd336d45bb12a38491cc85061d.jpeg)
