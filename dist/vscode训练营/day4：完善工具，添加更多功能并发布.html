<!DOCTYPE html><html><head><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta charset="utf-8"><title># 要做什么：完善代码工具并发布 - Documents</title><meta name="description" content=""><meta name="author" content=""><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><link rel="stylesheet" href="../assets/css/bulma.min.css"><link rel="stylesheet" href="../assets/css/app.css"><!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]--><link rel="shortcut icon" href=""></head><body dir="ltr"><nav class="columns navbar"><div class="column logo is-3 is-offset-1"><a class="is-brand" href="../index.html">Documents</a></div></nav><div class="columns content"><div class="column is-2-desktop is-3-widescreen is-hidden-touch"></div><div class="column article-container is-11-tablet is-8-desktop is-6-widescreen"><div class="breadcrumb-area"><a href="../index.html" class="breadcrumb-item">Home</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../vscode训练营/index.html" class="breadcrumb-item">vscode训练营</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../vscode训练营/day4：完善工具，添加更多功能并发布.html" class="breadcrumb-item">然后输入之前获取到的 token</a></div><h1 class="article-title"># 要做什么：完善代码工具并发布</h1><div class="article"><p>实现功能</p><ol><li>一键删除当前页面所有console</li><li>一键删除当前页面所有注释并格式化代码</li></ol><p>期待成功</p><p>在应用市场中看到自己的插件</p><h2 id="怎么做到尽可能做到复制粘贴就能有成果">怎么做到：尽可能做到复制粘贴就能有成果 <a class="markdownIt-Anchor" href="#怎么做到尽可能做到复制粘贴就能有成果">#</a></h2><h3 id="一一键删除所有console">一、一键删除所有console <a class="markdownIt-Anchor" href="#一一键删除所有console">#</a></h3><p>思路：我们首先获取所有log位置，然后把该位置置成空</p><h5 id="获取所有console">获取所有console <a class="markdownIt-Anchor" href="#获取所有console">#</a></h5><pre class="hljs"><code>function getAllLogStatements() {
	const editor = vscode.window.activeTextEditor;
	// 获取编辑器页面文本
	const document = editor.document;
	const documentText = document.getText();

	let logStatements = [];
	// 检测console的正则表达式
	const logRegex = /console.(log|debug|info|warn|error|assert|dir|dirxml|trace|group|groupEnd|time|timeEnd|profile|profileEnd|count)\((.*)\);?/g;
	let match;
	// 正则循环匹配页面文本
	while (match = logRegex.exec(documentText)) {
	// 每次匹配到当前的范围--Range
		let matchRange =
			new vscode.Range(
				document.positionAt(match.index),
				document.positionAt(match.index + match[0].length)
			);
		if (!matchRange.isEmpty)
		// 把Range放入数组
			logStatements.push(matchRange);
	}
	return logStatements;
}
</code></pre><h5 id="把获取到的console逐个删除">把获取到的console逐个删除 <a class="markdownIt-Anchor" href="#把获取到的console逐个删除">#</a></h5><pre class="hljs"><code>	const deleteAllLog = vscode.commands.registerCommand('firstExt.delLog', () =&gt; {
		const editor = vscode.window.activeTextEditor;
		if (!editor) { return; }

		let workspaceEdit = new vscode.WorkspaceEdit();
		const document = editor.document;

		const logStatements = getAllLogStatements();

		// 循环遍历每个匹配项的range，并删除
		logStatements.forEach((log) =&gt; {
			workspaceEdit.delete(document.uri, log);
		});
		// 完成后显示消息提醒
		vscode.workspace.applyEdit(workspaceEdit).then(() =&gt; {
			vscode.window.showInformationMessage(`${logStatements.length} console.log deleted`);
		});
	});
	context.subscriptions.push(deleteAllLog);
</code></pre><p>补充：vscode.WorkspaceEdit 工作区编辑方法，可操作多个文件，也可新增或删除 文本、文件、文件夹</p><h3 id="二一键删除所有注释并格式化代码">二、一键删除所有注释并格式化代码 <a class="markdownIt-Anchor" href="#二一键删除所有注释并格式化代码">#</a></h3><p>第一个思路还是正则替换法</p><pre class="hljs"><code>	let removeComments = vscode.commands.registerCommand('firstExt.removeComments', function () {
		const editor = vscode.window.activeTextEditor;
		editor.edit(editBuilder =&gt; {
			let text = editor.document.getText();
			// 正则匹配替换掉注释文本
			text = text.replace(/((\/\*([\w\W]+?)\*\/)|(\/\/(.(?!&quot;\)))+)|(^\s*(?=\r?$)\n))/gm, '').replace(/(^\s*(?=\r?$)\n)/gm, '').replace(/\\n\\n\?/gm, '');
			// 全量替换当前页面文本
			const end = new vscode.Position(editor.document.lineCount + 1, 0);
			editBuilder.replace(new vscode.Range(new vscode.Position(0, 0), end), text);
			// 执行格式化代码操作
			vscode.commands.executeCommand('editor.action.formatDocument');
		});
	});

	context.subscriptions.push(removeComments);
</code></pre><ul><li>调用VSCode内部命令方法：vscode.commands.executeCommand 传入参数是内置api名称<br><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h2ioh72obej20wg0u00wv.jpg" alt="Alt text" style="zoom:33%;"><br>VSCode暴露了大量的自身api可供选择，善用api完全可以打造一套VSCode工作流</li></ul><h3 id="三-打包--发布">三、 打包 &amp; 发布 <a class="markdownIt-Anchor" href="#三-打包--发布">#</a></h3><h3 id="发布先创建账号">发布，先创建账号 <a class="markdownIt-Anchor" href="#发布先创建账号">#</a></h3><p>Visual Studio Code 的<strong>应用市场</strong>基于微软自己的<code>Azure DevOps</code>；所以需要在两个平台都注册好账号。有账号后，根据 Azure DevOps 平台生成<code>PAT</code>（<code>Personal Access Token</code>，个人访问令牌）；根据<strong>应用市场</strong>创建发布者账号，有了这两者就能发布了。</p><p>整理如下</p><ul><li>注册账号</li><li>根据 Azure DevOps 平台生成<code>PAT</code>（<code>Personal Access Token</code>，个人访问令牌）；</li><li>根据<strong>应用市场</strong>创建发布者账号</li><li>根据 vsce 在本地发布</li></ul><h3 id="根据-azure-devops-平台生成-token">根据 Azure DevOps 平台生成 token <a class="markdownIt-Anchor" href="#根据-azure-devops-平台生成-token">#</a></h3><h5 id="登录-microsoft">登录 Microsoft <a class="markdownIt-Anchor" href="#登录-microsoft">#</a></h5><p>首先访问<a href="https://login.live.com/" target="_blank" rel="noopener">Microsoft 官网</a>登录你的<code>Microsoft</code>账号，没有的先注册一个：</p><figure><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h231rnykd9j20qi0k0dgz.jpg" alt=""></figure><p>中间会要求输入邮箱，没有也可以直接通过手机号获取一个</p><figure><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h231qb2s6zj20v20rcmz5.jpg" alt=""></figure><p>一路 next，直到创建成功。</p><h5 id="登录-azure">登录 Azure <a class="markdownIt-Anchor" href="#登录-azure">#</a></h5><p>然后访问：<a href="https://aka.ms/SignupAzureDevOps" target="_blank" rel="noopener">Azure 官网</a> ，如果你从来没有使用过 Azure，那么会看到如下提示：</p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h231wbevkqj20qa0ri775.jpg" alt="image-20220510092738875" style="zoom:33%;"><p>点击继续，默认会创建一个以邮箱前缀为名的组织。(只需要填写验证码即可)</p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h231xmb2fij20nw0xgtax.jpg" alt="image-20220510092853732" style="zoom:33%;"><h3 id="创建令牌">创建令牌 <a class="markdownIt-Anchor" href="#创建令牌">#</a></h3><p>默认进入组织的主页后，点击右上角的<code>Security</code>：</p><figure><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h231zo0c56j21h00u0jum.jpg" alt=""></figure><p>点击创建新的个人访问令牌，这里特别要注意</p><ul><li><code>Organization</code>要选择`all accessible organizations``</li><li>``Scopes<code>要选择</code>Full access</li></ul><p>否则后面发布会失败。</p><figure><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h231cx0iolj20hr0dywft.jpg" alt=""></figure><p>创建令牌成功后你<strong>需要本地记下来</strong>，因为网站是不会帮你保存的。</p><h3 id="根据应用市场创建发布者账号">根据应用市场创建发布者账号 <a class="markdownIt-Anchor" href="#根据应用市场创建发布者账号">#</a></h3><p>访问<a href="https://marketplace.visualstudio.com/manage/createpublisher?managePageRedirect=true" target="_blank" rel="noopener">应用市场</a>，填完名称，滑到最后保存即可</p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h2322ny359j219l0u0juj.jpg" alt="image-20220510093343787" style="zoom:33%;"><p>至此，我们就有了如下内容</p><ul><li>PAT：Personal Access Token，个人访问令牌</li><li>publisher：发布者账号</li></ul><p>就可以执行在本地发布的动作啦！</p><h3 id="根据-vsce-在本地发布">根据 vsce 在本地发布 <a class="markdownIt-Anchor" href="#根据-vsce-在本地发布">#</a></h3><p>进入自己的插件，如果没有，可以阅读【插件脚手架：如何创建一个插件】了解创建</p><h5 id="配置插件信息">配置插件信息 <a class="markdownIt-Anchor" href="#配置插件信息">#</a></h5><p>在发布前，我们需要配置一些项目信息在 package.json 中，下面是必备信息</p><ul><li>publisher：发布者 id</li><li>activationEvents：扩展的激活事件，建议先填指定文件类型激活（如 js 文件，<code>onLanguage:javascript</code>）配置项可见<a href="https://code.visualstudio.com/api/references/activation-events" target="_blank" rel="noopener">官网文档</a></li><li>repository：仓库地址</li></ul><p>其他还有很多配置，我们慢慢了解，文末放置 package.json 配置总览。</p><p>安装命令包</p><h5 id="利用发布工具发布插件">利用发布工具发布插件 <a class="markdownIt-Anchor" href="#利用发布工具发布插件">#</a></h5><p><a href="https://github.com/Microsoft/vsce" target="_blank" rel="noopener">vsce</a>是一个用于将插件发布到<a href="https://code.visualstudio.com/docs/editor/extension-gallery" target="_blank" rel="noopener">市场</a>上的命令行工具。</p><p>请确认本机已经安装了<a href="https://nodejs.org/" target="_blank" rel="noopener">Node.js</a>，然后运行：</p><pre class="hljs"><code>npm install -g vsce
</code></pre><p>然后你就可以在命令行里直接使用<code>vsce</code>了。下面是一个快速发布的示例</p><ol><li>登陆</li></ol><pre class="hljs"><code>vsce login [publisherName]
# 然后输入之前获取到的 token
</code></pre><ol start="2"><li>执行发布（这里的 patch 是指自动更新版本后发布，不带也可以，就得手动修改<code>package.json</code>文件了）</li></ol><pre class="hljs"><code>$ vsce publish patch
Publishing uuid@0.0.1...
Successfully published uuid@0.0.1!
</code></pre><p>完成后过几分钟就可以去 vscode 的扩展区看自己的插件啦！</p><h3 id="查看结果">查看结果 <a class="markdownIt-Anchor" href="#查看结果">#</a></h3><p>一图胜千言，静静体会成就感的美妙吧！</p><h2 id="课后作业用于感兴趣同学的拔高">课后作业：用于感兴趣同学的拔高 <a class="markdownIt-Anchor" href="#课后作业用于感兴趣同学的拔高">#</a></h2><p>恭喜，你已经拥有自己的插件啦！</p></div><div dir="ltr" class="level article-bar is-mobile"><div class="level-item has-text-centered"><a title="previous page" class="previouse-article-link" href="../vscode训练营/day3：vscode配置文件.html"><span class="icon icon-previous" data-icon="previous"></span><span class="link-content">&laquo; Previous</span></a></div><div class="level-item has-text-centered"><a title="font size" class="link-item link-item-size"><span class="icon icon-size" data-icon="size"></span></a></div><div class="level-item has-text-centered"><a title="table of content" class="link-item link-item-toc"><span class="icon icon-toc" data-icon="toc"></span></a></div><div class="level-item has-text-centered"><a title="top" href="#"><span class="icon icon-up" data-icon="up"></span> <span class="link-content">⤊ Top</span></a></div><div class="level-item has-text-centered"><a title="next page" class="next-article-link" href="../vscode训练营/开营计划.html"><span class="icon icon-next" data-icon="next"></span><span class="link-content">Next &raquo;</span></a></div></div></div><div class="column is-2-widescreen is-hidden"></div></div><div class="columns foot"><div class="column is-3 is-offset-9 build-by">Build by <a href="https://github.com/ruanyf/loppo" target="_blank">Loppo</a> 0.6.24</div></div><div class="book-toc notification is-warning is-hidden"><h3>Table of chapters &nbsp;<span class="title-close"><a class="button is-danger"> Close</a></span></h3><ul class="chapter-area"><li class="chapter-item"><a href="../shell编程训练营/index.html">shell编程训练营</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item"><a href="../shell编程训练营/1. Shell 的基本介绍、常用命令以及 Shell 的流程控制.html">我们为什么要学习shell</a></li><li class="chapter-item"><a href="../shell编程训练营/2. Shell 中的数组应用、参数处理和函数的应用.html">shell之语句</a></li><li class="chapter-item"><a href="../shell编程训练营/3. Shell 的函数、模块化、公共函数库.html">shell之函数</a></li><li class="chapter-item"><a href="../shell编程训练营/4. Shell周边：语言特殊点调试 Debug 方案vscode对shell的支持.html">语言特殊点</a></li><li class="chapter-item"><a href="../shell编程训练营/开营前置信息.html">开营前置信息.md</a></li></ul><li class="chapter-item"><a href="../vscode训练营/index.html">vscode训练营</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-collapse" data-icon="collapse"></span></a></li><ul class="chapter-level-1 chapter-level-1-current"><li class="chapter-item"><a href="../vscode训练营/day1：简单了解插件开发.html">day1：简单了解插件开发.md</a></li><li class="chapter-item"><a href="../vscode训练营/day2：实现一个简单代码工具.html">day2：实现一个简单代码工具.md</a></li><li class="chapter-item"><a href="../vscode训练营/day3：vscode配置文件.html">day3：vscode配置文件.md</a></li><li class="chapter-item chapter-item-current"><a href="../vscode训练营/day4：完善工具，添加更多功能并发布.html">然后输入之前获取到的 token</a></li><li class="chapter-item"><a href="../vscode训练营/开营计划.html">开营计划.md</a></li></ul><li class="chapter-item"><a href="../webpack插件训练营/index.html">webpack插件训练营</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item"><a href="../webpack插件训练营/day1. 简单了解webpack.html">day1. 简单了解webpack.md</a></li><li class="chapter-item"><a href="../webpack插件训练营/day2. webpack配置文件拆分及开发环境搭建.html">day2. webpack配置文件拆分及开发环境搭建.md</a></li><li class="chapter-item"><a href="../webpack插件训练营/day3. 文件类型处理篇.html">day3. 文件类型处理篇.md</a></li><li class="chapter-item"><a href="../webpack插件训练营/day4. 性能分析篇.html">day4. 性能分析篇.md</a></li><li class="chapter-item"><a href="../webpack插件训练营/day5. 性能优化篇：体积优化.html">day5. 性能优化篇：体积优化.md</a></li><li class="chapter-item"><a href="../webpack插件训练营/day6. 性能优化篇：缓存.html">day6. 性能优化篇：缓存.md</a></li><li class="chapter-item"><a href="../webpack插件训练营/day7. webpack 核心工作流程.html">day7. webpack 核心工作流程.md</a></li><li class="chapter-item"><a href="../webpack插件训练营/day8. 熟悉插件和loader的发布流程.html">day8. 熟悉插件和loader的发布流程.md</a></li><li class="chapter-item"><a href="../webpack插件训练营/开营计划.html">开营计划.md</a></li><li class="chapter-item"><a href="../webpack插件训练营/提效技巧篇：px转rem.html">提效技巧篇：px转rem.md</a></li><li class="chapter-item"><a href="../webpack插件训练营/提效技巧篇：基于glob实现自动化路由的MPA.html">提效技巧篇：基于glob实现自动化路由的MPA.md</a></li><li class="chapter-item"><a href="../webpack插件训练营/提效技巧篇：浏览器前缀自动添加.html">提效技巧篇：浏览器前缀自动添加.md</a></li></ul><li class="chapter-item"><a href="../前端爬虫/index.html">前端爬虫</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item"><a href="../前端爬虫/1. 了解爬虫 - puppetter实战.html">1. 了解爬虫 - puppetter实战.md</a></li><li class="chapter-item"><a href="../前端爬虫/2. 数据入库.html">2. 数据入库.md</a></li><li class="chapter-item"><a href="../前端爬虫/3. 展示应用实现.html">3. 展示应用实现.md</a></li><li class="chapter-item"><a href="../前端爬虫/4. 实战：kkb一键爬取所有vip课程.html">4. 实战：kkb一键爬取所有vip课程.md</a></li><li class="chapter-item"><a href="../前端爬虫/开营计划.html">开营计划.md</a></li></ul></ul><li class="chapter-item"><a href="../学习小组规划.html">学习小组规划.md</a></li><li class="chapter-item"><a href="../开营计划.html">开营计划.md</a></li><li class="chapter-item"><a href="../模板.html">模板.md</a></li><li class="chapter-item"><a href="../谷歌浏览器插件/index.html">谷歌浏览器插件</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item"><a href="../谷歌浏览器插件/开营计划.html">开营计划.md</a></li></ul></div><div class="progress-indicator"></div><!-- SCRIPTS --><script>var LOPPO={current_path:"vscode训练营/day4：完善工具，添加更多功能并发布.md",relative_root_path:"../",article_toc:'<ul class="markdownIt-TOC">\n<li><a href="#%E6%80%8E%E4%B9%88%E5%81%9A%E5%88%B0%E5%B0%BD%E5%8F%AF%E8%83%BD%E5%81%9A%E5%88%B0%E5%A4%8D%E5%88%B6%E7%B2%98%E8%B4%B4%E5%B0%B1%E8%83%BD%E6%9C%89%E6%88%90%E6%9E%9C">怎么做到：尽可能做到复制粘贴就能有成果</a>\n<ul>\n<li><a href="#%E4%B8%80%E4%B8%80%E9%94%AE%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89console">一、一键删除所有console</a></li>\n<li><a href="#%E4%BA%8C%E4%B8%80%E9%94%AE%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89%E6%B3%A8%E9%87%8A%E5%B9%B6%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%BB%A3%E7%A0%81">二、一键删除所有注释并格式化代码</a></li>\n<li><a href="#%E4%B8%89-%E6%89%93%E5%8C%85--%E5%8F%91%E5%B8%83">三、 打包 &amp; 发布</a></li>\n<li><a href="#%E5%8F%91%E5%B8%83%E5%85%88%E5%88%9B%E5%BB%BA%E8%B4%A6%E5%8F%B7">发布，先创建账号</a></li>\n<li><a href="#%E6%A0%B9%E6%8D%AE-azure-devops-%E5%B9%B3%E5%8F%B0%E7%94%9F%E6%88%90-token">根据 Azure DevOps 平台生成 token</a></li>\n<li><a href="#%E5%88%9B%E5%BB%BA%E4%BB%A4%E7%89%8C">创建令牌</a></li>\n<li><a href="#%E6%A0%B9%E6%8D%AE%E5%BA%94%E7%94%A8%E5%B8%82%E5%9C%BA%E5%88%9B%E5%BB%BA%E5%8F%91%E5%B8%83%E8%80%85%E8%B4%A6%E5%8F%B7">根据应用市场创建发布者账号</a></li>\n<li><a href="#%E6%A0%B9%E6%8D%AE-vsce-%E5%9C%A8%E6%9C%AC%E5%9C%B0%E5%8F%91%E5%B8%83">根据 vsce 在本地发布</a></li>\n<li><a href="#%E6%9F%A5%E7%9C%8B%E7%BB%93%E6%9E%9C">查看结果</a></li>\n</ul>\n</li>\n<li><a href="#%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A%E7%94%A8%E4%BA%8E%E6%84%9F%E5%85%B4%E8%B6%A3%E5%90%8C%E5%AD%A6%E7%9A%84%E6%8B%94%E9%AB%98">课后作业：用于感兴趣同学的拔高</a></li>\n</ul>\n'}</script><script src="../assets/js/app.js"></script></body></html>